<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-app.js";
    import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.1.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBbHQNkBkWqG_WlMP1XdnZSo-JChTaNdl8",
        databaseURL: "https://esp8266-metha-default-rtdb.firebaseio.com"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let lastTemp = 0;

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏û‡∏π‡∏î‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
    const speakThai = (text) => {
        const msg = new SpeechSynthesisUtterance();
        msg.text = text;
        msg.lang = 'th-TH';
        msg.rate = 0.9; 
        window.speechSynthesis.speak(msg);
    };

    onValue(ref(db, 'sensor'), (snapshot) => {
        const data = snapshot.val();
        if(data) {
            document.getElementById('temp').innerText = data.temperature.toFixed(1);
            document.getElementById('humid').innerText = data.humidity.toFixed(1);
            
            // ‡∏ñ‡πâ‡∏≤‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏õ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 0.5 ‡∏≠‡∏á‡∏®‡∏≤ ‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
            if (Math.abs(data.temperature - lastTemp) > 0.5) {
                speakThai(`‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ ${data.temperature.toFixed(1)} ‡∏≠‡∏á‡∏®‡∏≤‡πÄ‡∏ã‡∏•‡πÄ‡∏ã‡∏µ‡∏¢‡∏™ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô ${data.humidity.toFixed(0)} ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå`);
                lastTemp = data.temperature;
            }

            const statusBox = document.getElementById('obj-status');
            if(data.object) {
                statusBox.innerText = "üö® ‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏!";
                statusBox.className = "status-box alert";
                // speakThai("‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥"); // ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏û‡∏π‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡∏≠‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏
            } else {
                statusBox.innerText = "‚úÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏Å‡∏ï‡∏¥";
                statusBox.className = "status-box safe";
            }
        }
    });

    // ... ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ...
</script>
